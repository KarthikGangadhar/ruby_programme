kindly check with great blog on rack middleware
https://isotope11.com/blog/build-your-own-web-framework-with-rack-and-ruby-part-2